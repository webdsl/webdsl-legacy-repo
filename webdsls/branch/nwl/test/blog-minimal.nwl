module blog

entity Pst1 { 
  foo : String 
} 

entity User {
  name : String
}

entity Blog {
  url    : String 
  name   : String 
  posts  : Posts
  author : User 
}

entity Posts {
  post : Post
  next : Posts
}

entity Post { 
  url     : String 
  title   : String
  text    : WikiText
  blog    : Blog
  author  : User 
  blog    : Blog
  version : Int
}

define page user(u : User) {  
  header{ outputString(u.name) } 
}

define page blog(b : Blog) {
  header{outputString(b.name)}
  list{ 
    postList(b.posts)
  } 
}
  
define postList(posts : Posts) {
  if(posts) { 
    listitem{ navPost(posts.post) }
    postList(posts.next)
  }
}

define navPost(p : Post) {  
  navigate post(p) { outputString(p.title) }
}

define navUser(u : User) {  
  navigate user(u) { outputString(u.name) }
}
 
define page post(p : Post) {
  header{ outputString(p.title) }     
  outputWiki(p.text)
  par{ "Posted by " navUser(p.author) }   
  navigate editpost(p) { "Edit" }
}

define page editpost(p : Post) {
  header{outputString(p.title)}
  form{ 
    input(p.url) 
    input(p.title)
    input(p.text)
  }
}

define list()     { } 
define listitem() { } 
define header()   { } 
define par()      { } 

define outputString(x : String) { }
define outputWiki(x : WikiText) { }