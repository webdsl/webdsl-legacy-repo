module org/webdsl/dsl/to-java-servlet/id-property-annotation

imports
  libstrategolib
  
imports
	libwebdsl-front
	libback-end-transformations
	org/webdsl/dsl/to-java-servlet/emit-java

rules

  gen-unique-function-for-id-prop :
    (x_Class,x,s) -> <emit-java-code-local> compilation-unit|[
      package pkgname;
	
			@Partial
      public class x_Class {
        public static t1 _static_getUnique#_(org.hibernate.Session hibSession, Environment env, t ident, PrintWriter out){
          t1 result = (x1)
            hibSession.createCriteria(t1.class)
            .add(org.hibernate.criterion.Restrictions.eq("_"+"~x", ident)).uniqueResult();
          if(result != null){
            return result;
          }
          else{
            t1 newObject = new x1();
            newObject.set#x#NoEventsOrValidation(ident);
            hibSession.save(newObject);
            hibSession.flush();
            return newObject;
          }
        }
        
        public static boolean _static_isUnique#_(org.hibernate.Session hibSession, Environment env, t1 object, PrintWriter out){
          t1 result = (x1)
            hibSession.createCriteria(t1.class)
            .add(org.hibernate.criterion.Restrictions.eq("_"+"~x", object.get#x().toLowerCase())).uniqueResult();
          if(result != null && !result.getId().equals(object.getId()) ){
            return false;
          }
          else{
            return true;
          }
        }
        
        public static boolean _static_isUniqueId#_(org.hibernate.Session hibSession, Environment env, t ident, PrintWriter out){
          t1 temp = new x1();
          temp.set#x#NoEventsOrValidation(ident);
         	return _static_isUnique_(hibSession, env, temp, out);
        }
        
        public static boolean _static_isUniqueId#_(org.hibernate.Session hibSession, Environment env, t ident, t1 object, PrintWriter out){
          t1 tempobject = new x1(); // create a dummy object so the real object doesn't become dirty for hibernate
          tempobject.setId(object.getId());
          tempobject.set#x#NoEventsOrValidation(ident);
          return _static_isUnique_(hibSession, env, tempobject, out);
        }
      }
    ]|
    with  pkgname := <DomainPackage>
        ; t := <java-type> s
        ; t1 := <java-type-entity> x_Class
        ; x1 := <java-type-entity-name> x_Class
