module org/webdsl/dsl/to-java-servlet/template-render

imports
  libstratego-lib
  libjava-front

imports
  libwebdsl-front

rules

  GenerateCodeJavaServlet = render-java-servlet-template; fail
  
  render-java-servlet-template =
    ?def |[ define page x(farg*) { elem* } ]|
    ; with (    
      bstm1* := <  filter(not(   ?Define(_, _, _, _) 
                            <+ ?TemplateCall("title", _, _)))
                 ; elems-to-java-servlet
                 ; concat-with-sublists                      > elem*
      ; <generate-java-servlet-template-partial> 
        java |[ 
            @Partial
            private void render()
            {
              bstm1*          
            }
        ]|)
 
//coming from elements to xhtml
strategies // lists of elements

  elems-to-java-servlet = //filter because other non-visible stuff is in there like vardecl
    filter(elem-to-java-servlet <+ undefined-template-call)
    
  undefined-template-call :
    t@TemplateCall(f, args, body) -> []
    where log(|Warning(), ["no definition for template ", t])
    
rules
  elem-to-java-servlet :
    TemplateCall("dummy", [], elems) -> <elems-to-java-servlet> elems