module org/webdsl/dsl/to-seam/property-validation-annotation

imports 
  libstrategolib  
  Java-15
  libjava-front 
  
imports 
  libwebdsl-front
  
rules

  validation-annotations-setter :
    (x_old,x_new, annos) -> 
    bstm* |[
      //validate if value changed
      if(!org.webdsl.tools.Utils.equal(x_old,x_new)){
        bstm*
      }
    ]|
    with  bstm* := <validation-annotations-entity-helper> annos
    
  validation-annotations-collection-operations :
    annos -> <validation-annotations-entity-helper> annos
 
  validation-annotations-entity-helper :
    annos ->
    bstm* |[
        java.util.List<utils.ValidationException> exceptions = new java.util.LinkedList<utils.ValidationException>();
       
        bstm_validation*
       
        if(exceptions.size() > 0){
          //overwrite relevant objects the place of the validate anno determines this here
          /*
          for(utils.ValidationException ve : exceptions){
            ve.getRelevantObjects().clear();
            ve.getRelevantObjects().add(x_old);
          }*/
          throw new MultipleValidationExceptions(exceptions);
        }
    ]|
    with  bstm_validation* := <collect(validate-to-java-servlet(data-validation-to-java-servlet-collect(|"exceptions")))> annos
  
