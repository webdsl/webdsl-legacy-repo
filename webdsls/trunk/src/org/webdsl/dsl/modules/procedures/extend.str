module org/webdsl/dsl/modules/procedures/extend

imports
  libstrategolib
  libwebdsl-front

rules 

  procedure-extend-procelems :
    def|[ extend procedure x_id (x_o : srt) { procelem* }]| -> RemoveMe()
    with info(|["Extending procedure: ", x_id])
      ; <map(procedure-extend-procelem(|x_id, srt))> procelem*

  procedure-extend-procelem(|proc, srt) =
    ?procelem|[ enabled { stat* } ]|
    ; with(id
      ; SimpleSort(ent) := srt
      ; x_ent := <concat-strings> [ent, "ProcedureStatus"]
      ; <emit-webdsl-code> def|[
          extend entity x_ent {
            extend function enabled() {
              stat*
            }
          }
        ]|
      )

  procedure-extend-procelem(|proc, srt) =
    ?procelem|[ processed { stat* } ]|
    ; with(id
      ; SimpleSort(ent) := srt
      ; x_ent := <concat-strings> [ent, "ProcedureStatus"]
      ; <emit-webdsl-code> def|[
          extend entity x_ent {
            extend function processed() {
              stat*
            }
          }
        ]|
      )

  procedure-extend-procelem(|proc, srt) =
    ?procelem|[ done { stat* } ]|
    ; with(id
      ; SimpleSort(ent) := srt
      ; x_ent := <concat-strings> [ent, "ProcedureStatus"]
      ; <emit-webdsl-code> def|[
          extend entity x_ent {
            extend function done() {
              stat*
            }
          }
        ]|
      )

  procedure-extend-procelem(|proc, srt) =
    ?procelem|[ disabled { stat* } ]|
    ; with(id
      ; SimpleSort(ent) := srt
      ; x_ent := <concat-strings> [ent, "ProcedureStatus"]
      ; <emit-webdsl-code> def|[
          extend entity x_ent {
            extend function disabled() {
              stat*
            }
          }
        ]|
      )

