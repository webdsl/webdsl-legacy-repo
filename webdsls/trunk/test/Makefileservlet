TESTS_SUCCEED = $(wildcard succeed/*.app) $(wildcard succeed/*/*.app)
TESTS_SUCCEED_ALL = $(wildcard succeed/*.app) $(wildcard succeed/*/*.app)
TESTS_FAIL =$(wildcard fail/*.app) $(wildcard fail/*/*.app)
TESTS = $(TESTS_SUCCEED:.app=) $(TESTS_FAIL:.app=)

LN_S = ln -s

check: $(TESTS)
	@pass=0; fail=0; \
	for i in $(TESTS); do \
		if $(TESTENVIRONMENT) ./$$i; then\
		  pass=$$(($$pass + 1)); \
	  else \
	    fail=$$(($$fail + 1)); \
		fi; \
	done; \
	echo ;\
	echo "Total:"; \
	echo "PASS: $$pass"; \
	echo "FAIL: $$fail";

checkall: $(TESTS_SUCCEED_ALL)
	@pass=0; fail=0; \
	for i in $(TESTS_SUCCEED_ALL); do \
		if $(TESTENVIRONMENT) ./run-test-succeed-all-servlet.sh $$i; then\
		  pass=$$(($$pass + 1)); \
	  else \
	    fail=$$(($$fail + 1)); \
		fi; \
	done; \
	echo ;\
	echo "Total:"; \
	echo "PASS: $$pass"; \
	echo "FAIL: $$fail";

$(TESTS_SUCCEED:.app=): run-test-succeed.sh
	@$(LN_S) $$(pwd)/$< ./$@
	@chmod +x ./$@

$(TESTS_FAIL:.app=): run-test-fail.sh
	@$(LN_S) $$(pwd)/$< ./$@
	@chmod +x ./$@

clean:
	@echo "Removing all symbolic links to tests";
	-@rm -f $(TESTS);
	@echo "Removing all .out-files";
	-@rm -f fail/*.out fail/*/*.out succeed/*.out succeed/*/*.out
