application listasparam

section entities

entity News {
  caption :: String 
}

entity User {
  name :: String
}

init {
  var n: News := News{ caption := "hallo" };
  n.save();	
  var n2: News := News{ caption := "2e" };
  n2.save();
  var n3: News := News{ caption := "3e" };
  n3.save();	  
}

define page root() {
  header { "news" }
  var n: List<News> :=  select a from News as a;
  list {
    for (u: News in n) {
      listitem { output(u.caption) }
    }
  }
  header { "via template" }
  displaynews(n, User{ name := "michel" })
  
  header { "via search function (expects hallo,hallo ) "}
  var s: String := "hallo"
  var u: User := User{ name := "michel" }; //u added for missing behaviour
  
  block[id:= target, onclick := action { dosearch(s, u); }] {
     "click me to expand"
  }
  /*
  header { "action receiving a list "}
  var n2 : List<News> := searchHelper("hallo")
  form {
    action("click me", listaction(n2))
    list[id:= target2] {  }
  }
  
  bug in template lifting and list->listitem check here
  action listaction(news : List<News>) {
    for(ns: News in news) {
      append(target2,template { listitem { output(ns.caption) } });
    }
  }
  */
}

define displaynews (news: List<News>, user: User) {
  "generated by " out(user.name)
  list {
    for (u: News in news) {
      listitem { out(u.caption) }
    }
  }
}

function dosearch(s: String, anuser: User) {
  var news : List<News> := searchHelper(s);
  append(target,displaynews(news, anuser));
}

function searchHelper(s: String):  List<News> {
  var news : List<News> :=
       select u from News as u 
       where (u._caption = ~s);  
  return news;
}
